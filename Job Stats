declare @Start  date = '##StartDate##'
declare @end  date = '##EndDate##'
declare @companypageidlist table (id int)
declare @orderidlist table (id int)
insert into @companypageidlist values (5872) /*GOOGLE*/, (3976) /*Amazon*/, (11888) 
insert into @orderidlist values (176922) /*GOOGLE*/, (176910) /*Amazon*/, (175765) 

select viewtab.companyname, 
sum(viewtab.views) As Views, 
sum(clicktab.clicks) As Clicks, 
utilizationtab.utilization
from

(select sum(case when job.state = 4 and job.datestatechanged < @start then null else visitcount end) As Views, 
        jobvisits.jobid, job.companyname
    from jobvisits 
    join job on jobvisits.jobid = job.jobid
    where jobvisits.date between @start and @end
    and job.companyname in ('Facebook', 'Google', 'Amazon')
    group by jobvisits.jobid, job.companyname) Viewtab
    
full outer join
   
(select sum(ApplyButtonClickCount) As Clicks, job.jobid, companyname
        from JobApplyButtonClicks jabc join job on job.jobid = jabc.jobid
        where date between '2019-01-01' and '2019-10-12'
        and companyname in ('Facebook', 'Google', 'Amazon')
        group by job.jobid, companyname
     
union
  
        select sum(ApplyOutClickCount) As Clicks, job.jobid, companyname
        from JobApplyOutClick jaoc join job on job.jobid = jaoc.jobid
        where date between '2019-01-01' and '2019-10-12'
        and companyname in ('Facebook', 'Google', 'Amazon')
        group by job.jobid, companyname) Clicktab
    on Viewtab.jobid = clicktab.JobID
    
    cross join
    
    (select
    count(case when js.isavailable = 0 then 1 else null end)*100/
    (count(case when js.isavailable = 1 then 1 else null end) +
    count(case when js.isavailable = 0 then 1 else null end)) As Utilization
    from jobslot js
    where js.orderid in (select id from @orderidlist))  UtilizationTab
    
    group by viewtab.companyname, utilizationtab.utilization
